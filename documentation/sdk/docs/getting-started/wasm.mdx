import WarningPasswordStorage from '../_admonitions/_warning_password_storage.md'

# Getting Started with Wasm

<WarningPasswordStorage />

## Before You Start

The IOTA SDK library also offers dedicated [Node.js bindings](nodejs.mdx). The differences with this package are outlined
below.

|              |   Wasm bindings   |   Node.js bindings    |
|:-------------|:-----------------:|:---------------------:|
| Environment  | Node.js, browsers |        Node.js        |
| Installation |         -         | Rust, Cargo required* |
| Performance  |        ✔️         |         ✔️✔️          |
| Ledger Nano  |         ❌         |          ✔️           |
| Rocksdb      |         ❌         |          ✔️           |
| Stronghold   |         ❌         |          ✔️           |

* The Node.js bindings only needs to be compiled during `npm install` if a pre-compiled binary is not available for your
platform.

:::info tl;dr:

Use the Node.js bindings if you can. The Wasm bindings are just more portable and support browser environments.

:::

### Install Using a Package Manager

To start using the IOTA SDK in your Wasm project, you can install the IOTA SDK from your package manager of choice:

#### npm

```sh
npm i @iota/sdk-wasm
```

#### Yarn

```sh
yarn add @iota/sdk-wasm
```
### Web Setup

Unlike Node.js, a few more steps are required to use this binding in a browser.

The library loads the compiled Wasm file with an HTTP GET request, so the `iota_sdk_wasm_bg.wasm` file must be copied to
the root of the distribution folder.

A bundler such as [webpack](https://webpack.js.org/) or [rollup](https://rollupjs.org/) is recommended.

#### Rollup

1. Install `rollup-plugin-copy`:

     ```bash
     npm install rollup-plugin-copy --save-dev
    ```

2. Add the plugin to your `rollup.config.js`:

     ```js
     // Include the copy plugin.
     import copy from 'rollup-plugin-copy'

     // ...

     // Add the copy plugin to the `plugins` array:
     copy({
       targets: [{
         src: 'node_modules/@iota/sdk-wasm/web/wasm/iota_sdk_wasm_bg.wasm',
         dest: 'public',
         rename: 'iota_sdk_wasm_bg.wasm'
       }]
     })
    ```

#### Webpack

1. Install `copy-webpack-plugin`:

     ```bash
     npm install copy-webpack-plugin --save-dev
    ```

2. Add the plugin to your `webpack.config.js`:

    ```js
    // Include the copy plugin.
    const CopyWebPlugin = require('copy-webpack-plugin');

    // ...

    experiments: {
     // futureDefaults: true, // includes asyncWebAssembly, topLevelAwait etc.
     asyncWebAssembly: true
    }

    // Add the copy plugin to the `plugins` array:
    plugins: [
     new CopyWebPlugin({
       patterns: [
         {
           from: 'node_modules/@iota/sdk-wasm/web/wasm/iota_sdk_wasm_bg.wasm',
           to: 'iota_sdk_wasm_bg.wasm'
         }
       ]
     }),
     // other plugins...
    ]
    ```

## Usage

### Client

To use the Client module, you simply need to create a `Client`.

```rust
use iota_sdk::client::{
    Client,
};

let client = Client::builder()
    .with_node('https://api.testnet.shimmer.network')? // Insert your node URL here
    .finish()
    .await?;
        
let info = client.get_info().await?;
println!("Node Info: {info:?}")

Ok(())
```

### Wallet

To use the Wallet module, you need to create a `Wallet`:

```rust
use iota_sdk::{
    client::{
        constants::SHIMMER_COIN_TYPE,
        secret::{stronghold::StrongholdSecretManager, SecretManager},
    },
    wallet::{ClientOptions, Result, Wallet},
};
use std::path::PathBuf;

#[tokio::main]
async fn main() -> Result<()> {
    // Setup Stronghold secret manager.
    let secret_manager = StrongholdSecretManager::builder()
        .password("vault.stronghold") // A password to encrypt the stored data.WARNING: Never hardcode passwords in production code.
        .build(PathBuf::from("vault.stronghold"))?; // The path to store the account snapshot.

    let client_options = ClientOptions::new().with_node("https://api.testnet.shimmer.network")?;// The node to connect to.

    // Set up and store the wallet.
    let wallet = Wallet::builder()
        .with_secret_manager(SecretManager::Stronghold(secret_manager))
        .with_client_options(client_options)
        .with_coin_type(SHIMMER_COIN_TYPE)
        .finish()
        .await?;

    // Generate a mnemonic and store it in the Stronghold vault.
    // INFO: It is best practice to back up the mnemonic somewhere secure.
    let mnemonic = wallet.generate_mnemonic()?;
    wallet.store_mnemonic(mnemonic).await?;

    // Create an account.
    let account = wallet
        .create_account()
        .with_alias("Alice".to_string()) // A name to associate with the created account.
        .finish()
        .await?;


    Ok(())
}
```

### Web Usage

```javascript
import init, {Wallet, CoinType} from "@iota/sdk-wasm/web";

init().then(() => {
    const wallet = new Wallet({
        storagePath: './my-database',
        coinType: CoinType.Shimmer,
        clientOptions: {
            nodes: ['https://api.testnet.shimmer.network'],
        },
        secretManager: {
            mnemonic: "my development mnemonic",
        },
    });

    const account = await wallet.createAccount({
        alias: 'Alice',
    });

    account.addresses().then((addresses) => {
        console.log(addresses);
    });
}).catch(console.error);

// Default path to load is "iota_sdk_wasm_bg.wasm",
// but you can override it by passing a path explicitly.
//
// init("./static/iota_sdk_wasm_bg.wasm").then(...)
```


## What's next?

### How-To Guides

Once you have [installed the IOTA SDK](#install-the-iota-sdk), you can start building your application. You can find
usage examples in this Wiki's [how-to guides](../how_tos/accounts_and_addresses/create_mnemonic.mdx).

### More Examples

You can use the provided [Node.js code examples](https://github.com/iotaledger/iota-sdk/tree/develop/bindings/nodejs/examples) to get
acquainted with the IOTA SDK. You can use the following command to run any example:

```bash
cd examples
yarn run-example ./[example folder]/[example file]
```

- Where `[example file]` is the file name from the example folder. For example:

```bash
yarn run-example  examples/client/00_get_info.ts
```

## API Reference

The IOTA SDK Rust API Reference is in the [crate documentation](https://docs.rs/iota-sdk/latest/iota_sdk/).
